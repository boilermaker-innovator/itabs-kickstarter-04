<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iTabs for GoFundMe - Create Your Campaign</title>

```
<meta property="og:title" content="iTabs for GoFundMe - Make Your Campaign Stand Out">
<meta property="og:description" content="Turn your fundraiser into a visual story people actually read. Free tool.">
<meta property="og:type" content="website">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="iTabs for GoFundMe - Make Your Campaign Stand Out">
<meta name="twitter:description" content="Turn your fundraiser into a visual story people actually read. Free tool.">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
    :root {
        --gfm-green: #01BC66;
        --gfm-green-dark: #00A659;
        --gfm-green-light: #E6FBF0;
        --gfm-warm: #87290F;
        --gfm-warm-light: #FFF5F2;
        --text-dark: #1a1a1a;
        --text-mid: #4a5568;
        --text-light: #718096;
        --bg-white: #ffffff;
        --bg-grey: #f7f8fa;
        --border-light: #e2e8f0;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(180deg, var(--gfm-green-light) 0%, var(--bg-grey) 30%);
        min-height: 100vh;
        padding: 20px 15px 60px;
    }
    
    .page-header {
        text-align: center;
        margin-bottom: 25px;
    }
    
    .page-header h1 {
        font-size: 1.9em;
        font-weight: 700;
        color: var(--gfm-green);
        margin-bottom: 6px;
        letter-spacing: -0.5px;
    }
    
    .page-header p {
        color: var(--text-mid);
        font-size: 1em;
    }
    
    .page-header .hint {
        font-size: 0.85em;
        color: var(--text-light);
        margin-top: 8px;
    }
    
    /* Card Preview */
    .card {
        background: var(--bg-white);
        border-radius: 24px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(2, 169, 92, 0.08), 0 12px 40px rgba(0, 0, 0, 0.12);
        max-width: 420px;
        margin: 0 auto 25px;
    }
    
    .slideshow-container {
        position: relative;
        width: 100%;
        height: 280px;
        background: linear-gradient(135deg, var(--gfm-green) 0%, var(--gfm-green-dark) 100%);
        overflow: hidden;
    }
    
    .slides-track {
        display: flex;
        height: 100%;
        transition: transform 0.4s ease;
    }
    
    .slide {
        min-width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, var(--gfm-green) 0%, var(--gfm-green-dark) 100%);
        position: relative;
    }
    
    .slide img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }
    
    .slide .placeholder-content {
        text-align: center;
        color: white;
        padding: 80px 20px;
    }
    
    .slide .placeholder-content .num {
        width: 55px;
        height: 55px;
        background: rgba(255,255,255,0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        font-weight: 600;
        margin: 0 auto 12px;
    }
    
    .dots-container {
        position: absolute;
        bottom: 18px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 10;
    }
    
    .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: rgba(255,255,255,0.4);
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid white;
    }
    
    .dot.active {
        background: white;
        transform: scale(1.25);
    }
    
    .i-button {
        position: absolute;
        bottom: 18px;
        right: 18px;
        width: 54px;
        height: 54px;
        background: white;
        color: var(--gfm-green);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 30px;
        font-style: italic;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(0,0,0,0.25);
        border: 3px solid var(--gfm-green);
        z-index: 20;
        transition: transform 0.2s;
    }
    
    .i-button:hover {
        transform: scale(1.08);
    }
    
    .autoplay-indicator {
        position: absolute;
        top: 15px;
        left: 15px;
        background: rgba(0,0,0,0.4);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.75em;
        font-weight: 500;
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .autoplay-indicator .pulse {
        width: 8px;
        height: 8px;
        background: #fff;
        border-radius: 50%;
        animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(0.85); }
    }
    
    .card-content {
        padding: 18px;
        text-align: center;
    }
    
    .card-content h2 {
        color: var(--text-dark);
        font-size: 1.1em;
        font-weight: 600;
        margin-bottom: 4px;
        line-height: 1.3;
    }
    
    .card-content p {
        color: var(--text-light);
        font-size: 0.8em;
    }
    
    /* Sections */
    .section-box {
        background: var(--bg-white);
        border-radius: 18px;
        padding: 22px;
        max-width: 420px;
        margin: 0 auto 20px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }
    
    .section-box h3 {
        color: var(--gfm-green);
        font-size: 1.1em;
        font-weight: 600;
        margin-bottom: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .section-box p {
        color: var(--text-mid);
        font-size: 0.9em;
        line-height: 1.7;
    }
    
    .section-box .subtitle {
        color: var(--text-light);
        font-size: 0.85em;
        margin-bottom: 16px;
    }
    
    /* Why Section */
    .why-section {
        background: linear-gradient(135deg, var(--gfm-warm-light) 0%, #fff8f5 100%);
        border: 1px solid rgba(135, 41, 15, 0.15);
    }
    
    .why-section h3 {
        color: var(--gfm-warm);
    }
    
    /* API Key Section */
    .api-section {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border: 2px solid #f59e0b;
    }
    
    .api-section h3 {
        color: #b45309;
    }
    
    .api-key-input {
        width: 100%;
        padding: 13px 14px;
        border: 2px solid #f59e0b;
        border-radius: 12px;
        font-size: 0.95em;
        font-family: monospace;
        background: white;
    }
    
    .api-key-input:focus {
        outline: none;
        border-color: #d97706;
        box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
    }
    
    .api-status {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 10px;
        font-size: 0.85em;
    }
    
    .api-status.valid {
        color: #059669;
    }
    
    .api-status.invalid {
        color: #dc2626;
    }
    
    .api-status .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        border: none;
    }
    
    .api-status.valid .dot {
        background: #059669;
    }
    
    .api-status.invalid .dot {
        background: #dc2626;
    }
    
    /* AI Paste Section */
    .ai-section {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border: 2px solid #0ea5e9;
    }
    
    .ai-section h3 {
        color: #0369a1;
    }
    
    /* Form elements */
    .form-group {
        margin-bottom: 18px;
    }
    
    .form-group label {
        display: block;
        color: var(--text-dark);
        font-size: 0.88em;
        margin-bottom: 6px;
        font-weight: 500;
    }
    
    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 13px 14px;
        border: 2px solid var(--border-light);
        border-radius: 12px;
        font-size: 0.95em;
        font-family: inherit;
        transition: border-color 0.2s, box-shadow 0.2s;
        background: var(--bg-white);
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: var(--gfm-green);
        box-shadow: 0 0 0 3px rgba(2, 169, 92, 0.1);
    }
    
    .form-group textarea {
        resize: vertical;
        min-height: 100px;
    }
    
    .form-group .hint {
        font-size: 0.78em;
        color: var(--text-light);
        margin-top: 6px;
        line-height: 1.4;
    }
    
    /* Big AI Button */
    .ai-button {
        width: 100%;
        padding: 16px 24px;
        background: linear-gradient(135deg, #0ea5e9 0%, #0369a1 100%);
        color: white;
        border: none;
        border-radius: 14px;
        font-size: 1.05em;
        font-weight: 600;
        font-family: inherit;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 4px 15px rgba(14, 165, 233, 0.3);
    }
    
    .ai-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
    }
    
    .ai-button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
    }
    
    /* Photo Section */
    .photo-section {
        background: var(--gfm-green-light);
        border-radius: 14px;
        padding: 18px;
        margin-bottom: 18px;
        border: 2px dashed rgba(2, 169, 92, 0.3);
    }
    
    .photo-section h4 {
        color: var(--gfm-green);
        font-size: 0.95em;
        font-weight: 600;
        margin-bottom: 14px;
    }
    
    .select-photos-btn {
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, var(--gfm-green) 0%, var(--gfm-green-dark) 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1em;
        font-weight: 600;
        font-family: inherit;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: transform 0.2s;
    }
    
    .select-photos-btn:hover {
        box-shadow: 0 4px 15px rgba(2, 169, 92, 0.3);
    }
    
    .image-thumbs-row {
        display: flex;
        gap: 10px;
        margin-top: 16px;
        justify-content: center;
    }
    
    .image-thumb {
        width: 55px;
        height: 55px;
        border-radius: 12px;
        background: rgba(255,255,255,0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9em;
        font-weight: 600;
        color: var(--text-light);
        overflow: hidden;
        border: 2px solid rgba(2, 169, 92, 0.2);
    }
    
    .image-thumb.filled {
        border-color: var(--gfm-green);
    }
    
    .image-thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    /* URL inputs */
    .url-input {
        width: 100%;
        padding: 11px 12px;
        border: 2px solid var(--border-light);
        border-radius: 10px;
        font-size: 0.85em;
        font-family: inherit;
        margin-bottom: 8px;
        background: var(--bg-white);
    }
    
    .url-input:focus {
        outline: none;
        border-color: var(--gfm-green);
    }
    
    /* Context fields */
    .context-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 16px;
    }
    
    .context-grid input {
        padding: 11px 12px;
        border: 2px solid var(--border-light);
        border-radius: 10px;
        font-size: 0.85em;
        font-family: inherit;
    }
    
    .context-grid input:focus {
        outline: none;
        border-color: #0ea5e9;
    }
    
    /* Loading spinner */
    .spinner {
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255,255,255,0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* Status messages */
    .status-message {
        padding: 12px 16px;
        border-radius: 10px;
        margin-top: 14px;
        font-size: 0.9em;
        display: none;
    }
    
    .status-message.show {
        display: block;
    }
    
    .status-message.success {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #6ee7b7;
    }
    
    .status-message.error {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fca5a5;
    }
    
    .status-message.loading {
        background: #e0f2fe;
        color: #0369a1;
        border: 1px solid #7dd3fc;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    /* Edit Section */
    .edit-section {
        background: var(--bg-white);
        border-radius: 18px;
        padding: 22px;
        max-width: 420px;
        margin: 0 auto 20px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }
    
    .edit-section h3 {
        color: var(--gfm-green);
        font-size: 1.1em;
        font-weight: 600;
        margin-bottom: 6px;
    }
    
    .edit-section .subtitle {
        color: var(--text-light);
        font-size: 0.85em;
        margin-bottom: 18px;
    }
    
    /* Toggle switch */
    .toggle-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 16px;
        background: var(--bg-grey);
        border-radius: 12px;
        margin-bottom: 18px;
    }
    
    .toggle-row label {
        font-size: 0.9em;
        font-weight: 500;
        color: var(--text-dark);
    }
    
    .toggle-switch {
        position: relative;
        width: 52px;
        height: 28px;
    }
    
    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .3s;
        border-radius: 28px;
    }
    
    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .3s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .toggle-switch input:checked + .toggle-slider {
        background-color: var(--gfm-green);
    }
    
    .toggle-switch input:checked + .toggle-slider:before {
        transform: translateX(24px);
    }
    
    /* Save Section */
    .save-section {
        background: linear-gradient(135deg, var(--gfm-green-light) 0%, #d1fae5 100%);
        border: 2px solid var(--gfm-green);
    }
    
    .save-section h3 {
        color: var(--gfm-green-dark);
    }
    
    .save-button {
        width: 100%;
        padding: 16px 24px;
        background: linear-gradient(135deg, var(--gfm-green) 0%, var(--gfm-green-dark) 100%);
        color: white;
        border: none;
        border-radius: 14px;
        font-size: 1.1em;
        font-weight: 600;
        font-family: inherit;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 4px 15px rgba(2, 169, 92, 0.3);
        margin-bottom: 12px;
    }
    
    .save-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(2, 169, 92, 0.4);
    }
    
    .save-button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
    }
    
    .save-note {
        font-size: 0.8em;
        color: var(--text-light);
        text-align: center;
    }
    
    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .action-btn {
        flex: 1;
        min-width: calc(33% - 10px);
        padding: 12px 10px;
        border: 2px solid var(--border-light);
        background: var(--bg-white);
        border-radius: 10px;
        font-size: 0.85em;
        font-weight: 500;
        font-family: inherit;
        cursor: pointer;
        transition: all 0.2s;
        color: var(--text-mid);
    }
    
    .action-btn:hover {
        border-color: var(--gfm-green);
        background: var(--gfm-green-light);
        color: var(--gfm-green);
    }
    
    .action-btn.clear-btn:hover {
        border-color: #ef4444;
        background: #fef2f2;
        color: #dc2626;
    }
    
    /* Footer */
    .footer {
        text-align: center;
        padding: 25px 20px;
        max-width: 420px;
        margin: 0 auto;
    }
    
    .footer p {
        color: var(--text-light);
        font-size: 0.85em;
    }
    
    .footer a {
        color: var(--gfm-green);
        text-decoration: none;
        font-weight: 600;
    }
    
    /* ========== POPUP STYLES ========== */
    .popup-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.75);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 15px;
        backdrop-filter: blur(5px);
    }
    
    .popup-overlay.active {
        display: flex;
    }
    
    .popup {
        background: var(--bg-white);
        border-radius: 24px;
        max-width: 420px;
        width: 100%;
        max-height: 85vh;
        overflow-y: auto;
        position: relative;
        animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
        from { transform: translateY(50px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    .popup-header {
        background: linear-gradient(135deg, var(--gfm-green) 0%, var(--gfm-green-dark) 100%);
        color: white;
        padding: 26px 22px;
        text-align: center;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    .popup-header h3 {
        font-size: 1.35em;
        font-weight: 600;
        margin-bottom: 4px;
    }
    
    .popup-header p {
        opacity: 0.9;
        font-size: 0.9em;
    }
    
    .close-btn {
        position: absolute;
        top: 14px;
        right: 14px;
        width: 34px;
        height: 34px;
        background: rgba(255,255,255,0.2);
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 22px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .popup-body {
        padding: 24px;
    }
    
    .popup-section {
        margin-bottom: 22px;
    }
    
    .popup-section h4 {
        color: var(--gfm-green);
        font-size: 1.05em;
        font-weight: 600;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .popup-section p {
        color: var(--text-mid);
        line-height: 1.7;
        font-size: 0.95em;
    }
    
    .hook-box {
        background: linear-gradient(135deg, var(--gfm-green-light) 0%, #f0fff6 100%);
        border-left: 4px solid var(--gfm-green);
        padding: 18px 20px;
        margin-bottom: 24px;
        border-radius: 0 14px 14px 0;
    }
    
    .hook-text {
        font-size: 1.15em;
        font-weight: 600;
        color: var(--text-dark);
        line-height: 1.5;
        margin: 0;
    }
    
    .popup-button {
        display: block;
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, var(--gfm-green) 0%, var(--gfm-green-dark) 100%);
        color: white;
        text-align: center;
        text-decoration: none;
        border-radius: 14px;
        font-weight: 600;
        font-size: 1.05em;
        font-family: inherit;
        margin-top: 24px;
        border: none;
        cursor: pointer;
        transition: transform 0.2s;
        box-shadow: 0 4px 15px rgba(2, 169, 92, 0.3);
    }
    
    .popup-button:hover {
        transform: translateY(-2px);
    }
</style>
```

</head>
<body>
    <div class="page-header">
        <h1>iTabs for GoFundMe</h1>
        <p>Turn your story into something people actually read</p>
        <p class="hint">üëá Paste your campaign text, add photos, done</p>
    </div>

```
<!-- Preview Card -->
<div class="card">
    <div class="slideshow-container" id="slideshow">
        <div class="autoplay-indicator" id="autoplayIndicator" style="display: none;">
            <div class="pulse"></div>
            <span>Auto</span>
        </div>
        <div class="slides-track" id="slidesTrack">
            <!-- Slides generated by JS -->
        </div>
        <div class="dots-container" id="dotsContainer"></div>
        <div class="i-button" onclick="openPopup()">i</div>
    </div>
    <div class="card-content">
        <h2 id="previewTitle">Your Campaign Name</h2>
        <p>Swipe photos ‚Ä¢ Tap i for the full story</p>
    </div>
</div>

<!-- API Key Section - NEW -->
<div class="section-box api-section">
    <h3>üîë Your API Key</h3>
    <p class="subtitle">Enter your Gemini API key to enable AI features</p>
    
    <input type="password" 
           id="geminiApiKey" 
           class="api-key-input" 
           placeholder="Paste your Gemini API key here..."
           oninput="saveApiKey(this.value)">
    
    <div class="api-status" id="apiStatus" style="display: none;">
        <span class="dot"></span>
        <span id="apiStatusText"></span>
    </div>
    
    <p class="hint" style="margin-top: 12px;">
        <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #b45309;">
            üëâ Get a free API key from Google AI Studio
        </a>
    </p>
</div>

<!-- Why iTabs -->
<div class="section-box why-section">
    <h3>ü§î Why use iTabs for GoFundMe?</h3>
    <p>
        <strong>The problem:</strong> Most GoFundMe pages are walls of text. People scroll past without reading. Only 27% of campaigns reach their goal.<br><br>
        <strong>The solution:</strong> iTabs shows photos first (people stop to look), then the "i" button reveals the full story. People CHOOSE to learn more ‚Äî which means they're already engaged.<br><br>
        <strong>The result:</strong> More people understand your story ‚Üí More trust ‚Üí More donations.
    </p>
</div>

<!-- AI Paste Section -->
<div class="section-box ai-section">
    <h3>ü§ñ Paste Your Campaign Story</h3>
    <p class="subtitle">Paste your GoFundMe text and AI will organize it into clear sections</p>
    
    <div class="form-group">
        <label>GoFundMe Campaign URL</label>
        <input type="url" id="gofundmeUrl" placeholder="https://www.gofundme.com/f/help-bella-walk-run..." oninput="handleUrlPaste(this.value)">
        <p class="hint">Paste the campaign link - we'll use this for the donate button</p>
    </div>
    
    <div class="form-group">
        <label>Your GoFundMe story (copy & paste it here)</label>
        <textarea id="storyText" placeholder="Paste your GoFundMe campaign text here...
```

Or just describe your situation:

- What happened?
- Who needs help?
- How much do you need and for what?
- Why should people trust this?‚Äù style=‚Äúmin-height: 150px;‚Äù oninput=‚ÄúcheckForUrl(this.value)‚Äù></textarea>
  </div>
  
  ```
    <details style="margin-bottom: 16px;">
        <summary style="font-size: 0.9em; color: #0369a1; cursor: pointer; font-weight: 500;">+ Add extra context (optional)</summary>
        <div class="context-grid">
            <input type="text" id="contextWho" placeholder="Who are you? (sister, friend...)">
            <input type="text" id="contextUrgency" placeholder="Urgency? (surgery in 2 weeks)">
            <input type="text" id="contextLocation" placeholder="Location? (Perth, Sydney)">
            <input type="text" id="contextTried" placeholder="What's been tried?">
        </div>
        <div class="form-group" style="margin-top: 12px; margin-bottom: 0;">
            <input type="text" id="contextExtra" placeholder="Anything else people should know?">
        </div>
    </details>
    
    <button class="ai-button" id="aiButton" onclick="processWithAI()">
        <span id="aiButtonText">‚ú® Let AI Organize This</span>
    </button>
    
    <div class="status-message" id="statusMessage"></div>
  ```
  
    </div>
  
    <!-- Action Buttons -->
  
    <div class="section-box" style="padding: 16px;">
        <div class="action-buttons">
            <button class="action-btn clear-btn" onclick="clearForm()">
                üóëÔ∏è Clear All
            </button>
            <button class="action-btn template-btn" onclick="loadExample()">
                üìã Load Example
            </button>
            <button class="action-btn reset-btn" onclick="resetPhotos()">
                üñºÔ∏è Clear Photos
            </button>
        </div>
    </div>
  
    <!-- Photos Section -->
  
    <div class="section-box">
        <h3>üì∑ Add Your Photos</h3>
        <p class="subtitle">Photos make people stop scrolling. Choose up to 5.</p>
  
  ```
    <div class="photo-section">
        <button type="button" class="select-photos-btn" onclick="document.getElementById('photosPicker').click()">
            üì± Select Photos from Phone
        </button>
        <p style="text-align: center; font-size: 0.8em; color: var(--text-light); margin-top: 10px;">
            Photos will be uploaded when you save
        </p>
        
        <input type="file" id="photosPicker" accept="image/*" multiple style="display:none" onchange="handlePhotoSelect(this)">
        
        <div class="image-thumbs-row" id="thumbsRow">
            <div class="image-thumb" id="thumb1"><span>1</span></div>
            <div class="image-thumb" id="thumb2"><span>2</span></div>
            <div class="image-thumb" id="thumb3"><span>3</span></div>
            <div class="image-thumb" id="thumb4"><span>4</span></div>
            <div class="image-thumb" id="thumb5"><span>5</span></div>
        </div>
        
        <!-- URL paste option -->
        <details style="margin-top: 16px;">
            <summary style="font-size: 0.9em; color: var(--gfm-green); cursor: pointer; font-weight: 500;">Or paste image URLs instead ‚ñæ</summary>
            <div style="margin-top: 12px;">
                <p style="font-size: 0.8em; color: var(--text-light); margin-bottom: 10px;">
                    üí° Right-click any image online ‚Üí "Copy image address" then paste below
                </p>
                <input type="url" class="url-input" id="imageUrl1" placeholder="Image 1 URL..." oninput="handleUrlInput(1, this.value)">
                <input type="url" class="url-input" id="imageUrl2" placeholder="Image 2 URL..." oninput="handleUrlInput(2, this.value)">
                <input type="url" class="url-input" id="imageUrl3" placeholder="Image 3 URL..." oninput="handleUrlInput(3, this.value)">
                <input type="url" class="url-input" id="imageUrl4" placeholder="Image 4 URL..." oninput="handleUrlInput(4, this.value)">
                <input type="url" class="url-input" id="imageUrl5" placeholder="Image 5 URL..." oninput="handleUrlInput(5, this.value)">
            </div>
        </details>
    </div>
  ```
  
    </div>
  
    <!-- Edit Content Section -->
  
    <div class="edit-section">
        <h3>‚úèÔ∏è Edit Content</h3>
        <p class="subtitle">AI filled these in ‚Äî tweak as needed</p>
  
  ```
    <div class="form-group">
        <label>Campaign Name</label>
        <input type="text" id="campaignName" placeholder="e.g. Help Sarah Fight Cancer" oninput="updatePreview()">
    </div>
    
    <div class="form-group">
        <label>üí¨ The Hook ‚Äî One sentence that says it all</label>
        <input type="text" id="hookLine" placeholder="e.g. Sarah is a single mum fighting cancer. She needs your help." oninput="updatePreview()">
        <p class="hint">This appears first in the popup ‚Äî make it count</p>
    </div>
    
    <div class="form-group">
        <label>üö® The Crisis ‚Äî What happened?</label>
        <textarea id="section1" placeholder="What crisis or situation led to this campaign?" oninput="updatePreview()"></textarea>
    </div>
    
    <div class="form-group">
        <label>üíî Why We Need Help ‚Äî What's at stake?</label>
        <textarea id="section2" placeholder="What happens if you don't reach your goal?" oninput="updatePreview()"></textarea>
    </div>
    
    <div class="form-group">
        <label>üí∞ Where Money Goes ‚Äî Be specific</label>
        <textarea id="section3" placeholder="Break down exactly what donations will cover..." oninput="updatePreview()"></textarea>
    </div>
    
    <div class="form-group">
        <label>‚úÖ Why Trust This ‚Äî Verification</label>
        <textarea id="section4" placeholder="How can people verify this is real?" oninput="updatePreview()"></textarea>
    </div>
    
    <div class="toggle-row">
        <label>Auto-play slideshow</label>
        <div class="toggle-switch">
            <input type="checkbox" id="autoplayToggle" checked onchange="toggleAutoplay()">
            <span class="toggle-slider"></span>
        </div>
    </div>
    
    <div class="form-group">
        <label>Donate Button Text</label>
        <input type="text" id="buttonText" placeholder="e.g. Donate Now" value="Donate Now" oninput="updatePreview()">
    </div>
    
    <div class="form-group">
        <label>GoFundMe Link</label>
        <input type="url" id="buttonLink" placeholder="https://gofundme.com/f/your-campaign" oninput="updatePreview()">
        <p class="hint">Paste your full GoFundMe campaign URL</p>
    </div>
  ```
  
    </div>
  
    <!-- Preview Before Save -->
  
    <div class="section-box">
        <h3>üëÄ Preview Your iTabs</h3>
        <p class="subtitle">This is what people will see</p>
  
  ```
    <!-- Second Preview Card -->
    <div class="card" style="margin: 15px auto 0;">
        <div class="slideshow-container" id="slideshow2">
            <div class="autoplay-indicator" id="autoplayIndicator2" style="display: none;">
                <div class="pulse"></div>
                <span>Auto</span>
            </div>
            <div class="slides-track" id="slidesTrack2"></div>
            <div class="dots-container" id="dotsContainer2"></div>
            <div class="i-button" onclick="openPopup()">i</div>
        </div>
        <div class="card-content">
            <h2 id="previewTitle2">Your Campaign Name</h2>
            <p>Swipe photos ‚Ä¢ Tap i for the full story</p>
        </div>
    </div>
  ```
  
    </div>
  
    <!-- Save Section -->
  
    <div class="section-box save-section">
        <h3>üíæ Save Your iTabs</h3>
        <p class="subtitle">We'll upload your photos and create your shareable iTabs</p>
  
  ```
    <button class="save-button" id="saveButton" onclick="saveAndDownload()">
        <span id="saveButtonText">üöÄ Create My iTabs</span>
    </button>
    
    <p class="save-note">Downloads as an HTML file you can share anywhere</p>
    
    <div class="status-message" id="saveStatus"></div>
  ```
  
    </div>
  
    <!-- Footer -->
  
    <div class="footer">
        <p>Made with ‚ù§Ô∏è by <a href="https://itabs.ai" target="_blank">iTabs</a></p>
    </div>
  
    <!-- Popup -->
  
    <div class="popup-overlay" id="popup" onclick="closePopup(event)">
        <div class="popup" onclick="event.stopPropagation()">
            <div class="popup-header">
                <button class="close-btn" onclick="closePopup()">&times;</button>
                <h3 id="popupTitle">Campaign Name</h3>
                <p>The full story</p>
            </div>
            <div class="popup-body">
                <div class="hook-box" id="hookBox" style="display: none;">
                    <p id="popupHook" class="hook-text"></p>
                </div>
  
  ```
            <div class="popup-section" id="popupSection1">
                <h4>üö® The Crisis</h4>
                <p id="popupText1"></p>
            </div>
            
            <div class="popup-section" id="popupSection2">
                <h4>üíî Why We Need Help</h4>
                <p id="popupText2"></p>
            </div>
            
            <div class="popup-section" id="popupSection3">
                <h4>üí∞ Where Money Goes</h4>
                <p id="popupText3"></p>
            </div>
            
            <div class="popup-section" id="popupSection4">
                <h4>‚úÖ Why Trust This</h4>
                <p id="popupText4"></p>
            </div>
            
            <a href="#" id="popupButton" class="popup-button" target="_blank">Donate Now</a>
        </div>
    </div>
  ```
  
    </div>
  
    <script>
        // ImgBB API Key (for image uploads)
        const IMGBB_API_KEY = '59cd5b2935b5b01bc744b5b0a1d26ee0';
        
        // State
        let currentSlide = 0;
        let autoplayInterval = null;
        let selectedPhotos = []; // File objects
        let photoDataUrls = []; // For preview
        let uploadedImageUrls = []; // After ImgBB upload
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved API key from localStorage
            const savedApiKey = localStorage.getItem('gemini_api_key');
            if (savedApiKey) {
                document.getElementById('geminiApiKey').value = savedApiKey;
                updateApiStatus(true, 'API key saved');
            }
            
            loadExample(); // Start with example loaded
            setupTouchEvents();
            if (document.getElementById('autoplayToggle').checked) {
                startAutoplay();
            }
        });
        
        // ========== API KEY MANAGEMENT ==========
        function saveApiKey(key) {
            key = key.trim();
            if (key) {
                localStorage.setItem('gemini_api_key', key);
                updateApiStatus(true, 'API key saved ‚úì');
            } else {
                localStorage.removeItem('gemini_api_key');
                updateApiStatus(false, 'No API key');
            }
        }
        
        function updateApiStatus(valid, message) {
            const statusEl = document.getElementById('apiStatus');
            const textEl = document.getElementById('apiStatusText');
            
            statusEl.style.display = 'flex';
            statusEl.className = 'api-status ' + (valid ? 'valid' : 'invalid');
            textEl.textContent = message;
        }
        
        function getApiKey() {
            // First try the input field, then localStorage
            const inputKey = document.getElementById('geminiApiKey').value.trim();
            if (inputKey) return inputKey;
            return localStorage.getItem('gemini_api_key') || '';
        }
        
        // ========== URL EXTRACTION ==========
        function extractGofundmeUrl(text) {
            // Look for GoFundMe URLs in the text
            const patterns = [
                /https?:\/\/(www\.)?gofundme\.com\/f\/[a-zA-Z0-9-]+/gi,
                /gofundme\.com\/f\/[a-zA-Z0-9-]+/gi
            ];
            
            for (const pattern of patterns) {
                const matches = text.match(pattern);
                if (matches && matches.length > 0) {
                    let url = matches[0];
                    // Make sure it has https://
                    if (!url.startsWith('http')) {
                        url = 'https://www.' + url;
                    }
                    return url;
                }
            }
            return null;
        }
        
        function checkForUrl(text) {
            const url = extractGofundmeUrl(text);
            if (url) {
                document.getElementById('gofundmeUrl').value = url;
                document.getElementById('buttonLink').value = url;
                updatePreview();
            }
        }
        
        function handleUrlPaste(url) {
            url = url.trim();
            if (url) {
                document.getElementById('buttonLink').value = url;
                updatePreview();
            }
        }
        
        // ========== AI PROCESSING ==========
        async function processWithAI() {
            const apiKey = getApiKey();
            const storyText = document.getElementById('storyText').value.trim();
            
            if (!apiKey) {
                showStatus('statusMessage', '‚ö†Ô∏è Please enter your Gemini API key first (yellow box above)', 'error');
                document.getElementById('geminiApiKey').focus();
                return;
            }
            
            if (!storyText) {
                showStatus('statusMessage', 'Please paste your campaign story first', 'error');
                return;
            }
            
            // Get optional context
            const contextWho = document.getElementById('contextWho').value.trim();
            const contextUrgency = document.getElementById('contextUrgency').value.trim();
            const contextLocation = document.getElementById('contextLocation').value.trim();
            const contextTried = document.getElementById('contextTried').value.trim();
            const contextExtra = document.getElementById('contextExtra').value.trim();
            
            // Build context string
            let contextInfo = '';
            if (contextWho) contextInfo += `\nWho is writing this: ${contextWho}`;
            if (contextUrgency) contextInfo += `\nUrgency: ${contextUrgency}`;
            if (contextLocation) contextInfo += `\nLocation: ${contextLocation}`;
            if (contextTried) contextInfo += `\nWhat's been tried: ${contextTried}`;
            if (contextExtra) contextInfo += `\nExtra info: ${contextExtra}`;
            
            const button = document.getElementById('aiButton');
            const buttonText = document.getElementById('aiButtonText');
            
            button.disabled = true;
            buttonText.innerHTML = '<div class="spinner"></div> Processing...';
            showStatus('statusMessage', 'AI is organizing your story...', 'loading');
            
            const prompt = `You are helping organize a GoFundMe campaign story into clear sections.

Here is the campaign story:
‚Äú‚Äù‚Äù
${storyText}
‚Äú‚Äù‚Äù
${contextInfo ? `\nAdditional context:${contextInfo}` : ‚Äò‚Äô}

Please extract and organize this into the following JSON format. Use ONLY facts from the provided text - do not invent anything. Write in first person if the original is first person, or third person if appropriate.

{
‚ÄúcampaignName‚Äù: ‚ÄúA short, compelling campaign title (max 8 words)‚Äù,
‚Äúhook‚Äù: ‚ÄúOne powerful sentence that summarizes the entire situation and need (max 25 words)‚Äù,
‚Äúcrisis‚Äù: ‚ÄúWhat happened? The situation that led to this campaign (2-4 sentences)‚Äù,
‚ÄúwhyHelp‚Äù: ‚ÄúWhat‚Äôs at stake? Why is help needed urgently? (2-4 sentences)‚Äù,
‚ÄúwhereMoney‚Äù: ‚ÄúSpecific breakdown of what donations will cover (be specific with amounts if mentioned)‚Äù,
‚ÄúwhyTrust‚Äù: ‚ÄúHow can people verify this is real? Who is running this? (2-3 sentences)‚Äù
}

Respond with ONLY the JSON, no other text.`;

```
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.3,
                        maxOutputTokens: 1000
                    }
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                console.error('API Error:', errorData);
                
                // Check for API key error
                if (errorData.error?.message?.includes('API key')) {
                    updateApiStatus(false, 'Invalid API key');
                    throw new Error('Invalid API key. Please check your Gemini API key.');
                }
                throw new Error(errorData.error?.message || 'API request failed');
            }
            
            // API key worked!
            updateApiStatus(true, 'API key working ‚úì');
            
            const data = await response.json();
            console.log('API Response:', data);
            
            if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                let resultText = data.candidates[0].content.parts[0].text;
                console.log('Raw result:', resultText);
                
                // Clean up the response
                resultText = resultText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                
                const result = JSON.parse(resultText);
                
                // Fill in the form fields
                document.getElementById('campaignName').value = result.campaignName || '';
                document.getElementById('hookLine').value = result.hook || '';
                document.getElementById('section1').value = result.crisis || '';
                document.getElementById('section2').value = result.whyHelp || '';
                document.getElementById('section3').value = result.whereMoney || '';
                document.getElementById('section4').value = result.whyTrust || '';
                
                updatePreview();
                showStatus('statusMessage', '‚úÖ Done! Scroll down to review and add photos.', 'success');
                
                // Also set the button link if we have a GoFundMe URL
                const gofundmeUrl = document.getElementById('gofundmeUrl').value.trim();
                if (gofundmeUrl) {
                    document.getElementById('buttonLink').value = gofundmeUrl;
                }
            } else {
                console.error('Unexpected response structure:', data);
                throw new Error('Unexpected response format');
            }
        } catch (error) {
            console.error('AI Error:', error);
            showStatus('statusMessage', 'Something went wrong: ' + error.message + '. Try again or fill in manually.', 'error');
        }
        
        button.disabled = false;
        buttonText.textContent = '‚ú® Let AI Organize This';
    }
    
    // ========== PHOTO HANDLING ==========
    function handlePhotoSelect(input) {
        const files = Array.from(input.files).slice(0, 5);
        selectedPhotos = files;
        photoDataUrls = [];
        
        files.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                photoDataUrls[index] = e.target.result;
                updateThumbnail(index + 1, e.target.result);
                updatePreview();
            };
            reader.readAsDataURL(file);
        });
        
        // Clear remaining thumbs
        for (let i = files.length + 1; i <= 5; i++) {
            clearThumbnail(i);
        }
    }
    
    function updateThumbnail(num, dataUrl) {
        const thumb = document.getElementById('thumb' + num);
        thumb.innerHTML = `<img src="${dataUrl}" alt="Photo ${num}">`;
        thumb.classList.add('filled');
    }
    
    function clearThumbnail(num) {
        const thumb = document.getElementById('thumb' + num);
        thumb.innerHTML = `<span>${num}</span>`;
        thumb.classList.remove('filled');
    }
    
    // Handle URL paste for images
    function handleUrlInput(num, url) {
        url = url.trim();
        
        if (!url) {
            photoDataUrls[num - 1] = null;
            clearThumbnail(num);
            updatePreview();
            return;
        }
        
        // Test if image loads
        const img = new Image();
        img.onload = function() {
            photoDataUrls[num - 1] = url;
            uploadedImageUrls[num - 1] = url; // URLs don't need uploading
            updateThumbnail(num, url);
            updatePreview();
        };
        img.onerror = function() {
            // Still save it, might work
            photoDataUrls[num - 1] = url;
            uploadedImageUrls[num - 1] = url;
            const thumb = document.getElementById('thumb' + num);
            thumb.innerHTML = `<span>?</span>`;
            thumb.classList.remove('filled');
            updatePreview();
        };
        img.src = url;
    }
    
    // ========== IMAGE COMPRESSION ==========
    function compressImage(file, maxWidth = 800, quality = 0.85) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    
                    // Only resize if larger than maxWidth
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convert to blob
                    canvas.toBlob((blob) => {
                        resolve(blob);
                    }, 'image/jpeg', quality);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });
    }
    
    // ========== IMAGE UPLOAD TO IMGBB ==========
    async function uploadImagesToImgBB() {
        uploadedImageUrls = [];
        
        for (let i = 0; i < selectedPhotos.length; i++) {
            const file = selectedPhotos[i];
            
            // Compress the image first
            const compressedBlob = await compressImage(file, 800, 0.85);
            
            const formData = new FormData();
            formData.append('image', compressedBlob, 'photo.jpg');
            
            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    uploadedImageUrls.push(data.data.url);
                } else {
                    console.error('ImgBB upload failed:', data);
                    uploadedImageUrls.push(photoDataUrls[i]); // Fallback to data URL
                }
            } catch (error) {
                console.error('Upload error:', error);
                uploadedImageUrls.push(photoDataUrls[i]); // Fallback
            }
        }
        
        return uploadedImageUrls;
    }
    
    // ========== PREVIEW UPDATE ==========
    function updatePreview() {
        const name = document.getElementById('campaignName').value || 'Your Campaign Name';
        const hook = document.getElementById('hookLine').value;
        const section1 = document.getElementById('section1').value;
        const section2 = document.getElementById('section2').value;
        const section3 = document.getElementById('section3').value;
        const section4 = document.getElementById('section4').value;
        const buttonText = document.getElementById('buttonText').value || 'Donate Now';
        const buttonLink = document.getElementById('buttonLink').value || '#';
        
        // Update titles (both previews)
        document.getElementById('previewTitle').textContent = name;
        document.getElementById('previewTitle2').textContent = name;
        document.getElementById('popupTitle').textContent = name;
        
        // Count actual photos (not empty slots)
        const actualPhotos = photoDataUrls.filter(url => url && url.trim() !== '');
        const photoCount = actualPhotos.length > 0 ? actualPhotos.length : 1; // At least 1 slide
        
        // Build slides HTML - only for actual photos
        let slidesHTML = '';
        let dotsHTML = '';
        
        if (actualPhotos.length > 0) {
            actualPhotos.forEach((imageUrl, index) => {
                slidesHTML += `<div class="slide"><img src="${imageUrl}" alt="Photo ${index + 1}"></div>`;
                const isActive = index === currentSlide ? 'active' : '';
                dotsHTML += `<div class="dot ${isActive}" onclick="goToSlide(${index})"></div>`;
            });
        } else {
            // Show one placeholder if no photos
            slidesHTML = `<div class="slide"><div class="placeholder-content"><div class="num">1</div><p>Add photo</p></div></div>`;
            dotsHTML = `<div class="dot active"></div>`;
        }
        
        // Make sure currentSlide is within bounds
        if (currentSlide >= photoCount) {
            currentSlide = 0;
        }
        
        // Update both slideshows
        document.getElementById('slidesTrack').innerHTML = slidesHTML;
        document.getElementById('dotsContainer').innerHTML = dotsHTML;
        document.getElementById('slidesTrack').style.transform = `translateX(-${currentSlide * 100}%)`;
        
        document.getElementById('slidesTrack2').innerHTML = slidesHTML;
        document.getElementById('dotsContainer2').innerHTML = dotsHTML;
        document.getElementById('slidesTrack2').style.transform = `translateX(-${currentSlide * 100}%)`;
        
        // Update popup
        document.getElementById('popupHook').textContent = hook;
        document.getElementById('hookBox').style.display = hook ? 'block' : 'none';
        
        document.getElementById('popupText1').textContent = section1 || 'What crisis or situation led to this campaign...';
        document.getElementById('popupText2').textContent = section2 || 'What happens if you don\'t reach your goal...';
        document.getElementById('popupText3').textContent = section3 || 'Break down exactly what donations will cover...';
        document.getElementById('popupText4').textContent = section4 || 'How can people verify this is real...';
        
        document.getElementById('popupSection1').style.display = section1 ? 'block' : 'none';
        document.getElementById('popupSection2').style.display = section2 ? 'block' : 'none';
        document.getElementById('popupSection3').style.display = section3 ? 'block' : 'none';
        document.getElementById('popupSection4').style.display = section4 ? 'block' : 'none';
        
        document.getElementById('popupButton').textContent = buttonText;
        document.getElementById('popupButton').href = buttonLink;
    }
    
    // ========== SLIDESHOW CONTROLS ==========
    function goToSlide(index) {
        currentSlide = index;
        
        // Update both slideshows
        document.getElementById('slidesTrack').style.transform = `translateX(-${currentSlide * 100}%)`;
        document.getElementById('slidesTrack2').style.transform = `translateX(-${currentSlide * 100}%)`;
        
        // Update dots on both
        document.querySelectorAll('.dot').forEach((dot, i) => {
            dot.classList.toggle('active', i % 5 === currentSlide);
        });
    }
    
    function nextSlide() {
        const actualPhotos = photoDataUrls.filter(url => url && url.trim() !== '');
        const photoCount = actualPhotos.length > 0 ? actualPhotos.length : 1;
        currentSlide = (currentSlide + 1) % photoCount;
        goToSlide(currentSlide);
    }
    
    function startAutoplay() {
        stopAutoplay();
        autoplayInterval = setInterval(nextSlide, 3000);
        document.getElementById('autoplayIndicator').style.display = 'flex';
        document.getElementById('autoplayIndicator2').style.display = 'flex';
    }
    
    function stopAutoplay() {
        if (autoplayInterval) {
            clearInterval(autoplayInterval);
            autoplayInterval = null;
        }
        document.getElementById('autoplayIndicator').style.display = 'none';
        document.getElementById('autoplayIndicator2').style.display = 'none';
    }
    
    function toggleAutoplay() {
        if (document.getElementById('autoplayToggle').checked) {
            startAutoplay();
        } else {
            stopAutoplay();
        }
    }
    
    function setupTouchEvents() {
        const slideshow = document.getElementById('slideshow');
        let touchStartX = 0;
        
        slideshow.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        }, false);
        
        slideshow.addEventListener('touchend', e => {
            const diff = touchStartX - e.changedTouches[0].screenX;
            if (Math.abs(diff) > 50) {
                const actualPhotos = photoDataUrls.filter(url => url && url.trim() !== '');
                const photoCount = actualPhotos.length > 0 ? actualPhotos.length : 1;
                if (diff > 0) {
                    nextSlide();
                } else {
                    currentSlide = (currentSlide - 1 + photoCount) % photoCount;
                    goToSlide(currentSlide);
                }
            }
        }, false);
    }
    
    // ========== POPUP ==========
    function openPopup() {
        document.getElementById('popup').classList.add('active');
        document.body.style.overflow = 'hidden';
        stopAutoplay();
    }
    
    function closePopup(event) {
        if (!event || event.target.id === 'popup' || event.target.classList.contains('close-btn')) {
            document.getElementById('popup').classList.remove('active');
            document.body.style.overflow = '';
            if (document.getElementById('autoplayToggle').checked) {
                startAutoplay();
            }
        }
    }
    
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') closePopup();
    });
    
    // ========== STATUS MESSAGES ==========
    function showStatus(elementId, message, type) {
        const el = document.getElementById(elementId);
        el.className = 'status-message show ' + type;
        
        if (type === 'loading') {
            el.innerHTML = `<div class="spinner"></div> ${message}`;
        } else {
            el.textContent = message;
        }
    }
    
    function hideStatus(elementId) {
        document.getElementById(elementId).classList.remove('show');
    }
    
    // ========== SAVE & DOWNLOAD ==========
    async function saveAndDownload() {
        const button = document.getElementById('saveButton');
        const buttonText = document.getElementById('saveButtonText');
        
        // Validate
        const campaignName = document.getElementById('campaignName').value.trim();
        if (!campaignName) {
            showStatus('saveStatus', 'Please add a campaign name', 'error');
            return;
        }
        
        // Check if we have photos (either from file select or URL paste)
        const hasFilePhotos = selectedPhotos.length > 0;
        const hasUrlPhotos = photoDataUrls.some(url => url && url.trim() !== '');
        
        if (!hasFilePhotos && !hasUrlPhotos) {
            showStatus('saveStatus', 'Please add at least one photo', 'error');
            return;
        }
        
        button.disabled = true;
        buttonText.innerHTML = '<div class="spinner"></div> Uploading photos...';
        showStatus('saveStatus', 'Uploading your photos...', 'loading');
        
        try {
            // Upload images to ImgBB (only if we have file uploads)
            if (hasFilePhotos) {
                await uploadImagesToImgBB();
            } else {
                // Use URL photos directly
                uploadedImageUrls = photoDataUrls.filter(url => url && url.trim() !== '');
            }
            
            buttonText.innerHTML = '<div class="spinner"></div> Creating iTabs...';
            showStatus('saveStatus', 'Creating your iTabs file...', 'loading');
            
            // Generate the HTML file
            const htmlContent = generateStandaloneHTML();
            
            // Download it
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `itabs-${campaignName.toLowerCase().replace(/[^a-z0-9]+/g, '-')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('saveStatus', '‚úÖ Downloaded! Share this file anywhere.', 'success');
        } catch (error) {
            console.error('Save error:', error);
            showStatus('saveStatus', 'Something went wrong. Please try again.', 'error');
        }
        
        button.disabled = false;
        buttonText.textContent = 'üöÄ Create My iTabs';
    }
    
    function generateStandaloneHTML() {
        const campaignName = document.getElementById('campaignName').value || 'Campaign';
        const hook = document.getElementById('hookLine').value;
        const section1 = document.getElementById('section1').value;
        const section2 = document.getElementById('section2').value;
        const section3 = document.getElementById('section3').value;
        const section4 = document.getElementById('section4').value;
        const buttonText = document.getElementById('buttonText').value || 'Donate Now';
        const buttonLink = document.getElementById('buttonLink').value || '#';
        const autoplay = document.getElementById('autoplayToggle').checked;
        
        // Use uploaded URLs, falling back to photoDataUrls
        const images = uploadedImageUrls.length > 0 ? uploadedImageUrls : photoDataUrls.filter(url => url && url.trim() !== '');
        
        return `<!DOCTYPE html>
```

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${escapeHtml(campaignName)} - iTabs</title>
    <meta property="og:title" content="${escapeHtml(campaignName)}">
    <meta property="og:description" content="${escapeHtml(hook || section1?.substring(0, 150) || 'Support this campaign')}">
    <meta property="og:image" content="${images[0] || ''}">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="${escapeHtml(campaignName)}">
    <meta name="twitter:description" content="${escapeHtml(hook || section1?.substring(0, 150) || 'Support this campaign')}">
    <meta name="twitter:image" content="${images[0] || ''}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Poppins',sans-serif;background:#f7f8fa;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
        .card{background:#fff;border-radius:24px;overflow:hidden;box-shadow:0 12px 40px rgba(0,0,0,0.12);max-width:420px;width:100%}
        .slideshow{position:relative;width:100%;height:280px;background:linear-gradient(135deg,#01BC66,#00A659);overflow:hidden}
        .slides-track{display:flex;height:100%;transition:transform 0.4s ease}
        .slide{min-width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#01BC66,#00A659)}
        .slide img{max-width:100%;max-height:100%;object-fit:contain}
        .dots{position:absolute;bottom:18px;left:50%;transform:translateX(-50%);display:flex;gap:10px;z-index:10}
        .dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.4);cursor:pointer;border:2px solid #fff;transition:all 0.3s}
        .dot.active{background:#fff;transform:scale(1.25)}
        .i-btn{position:absolute;bottom:18px;right:18px;width:54px;height:54px;background:#fff;color:#01BC66;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:30px;font-style:italic;cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,0.25);border:3px solid #01BC66;z-index:20;transition:transform 0.2s}
        .i-btn:hover{transform:scale(1.08)}
        .auto-ind{position:absolute;top:15px;left:15px;background:rgba(0,0,0,0.4);color:#fff;padding:5px 12px;border-radius:20px;font-size:0.75em;z-index:10;display:${autoplay ? 'flex' : 'none'};align-items:center;gap:6px}
        .pulse{width:8px;height:8px;background:#fff;border-radius:50%;animation:pulse 1.5s infinite}
        @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(0.85)}}
        .content{padding:18px;text-align:center}
        .content h2{color:#1a1a1a;font-size:1.1em;font-weight:600;margin-bottom:4px;line-height:1.3}
        .content p{color:#718096;font-size:0.8em}
        .popup-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.75);z-index:1000;align-items:center;justify-content:center;padding:15px}
        .popup-overlay.active{display:flex}
        .popup{background:#fff;border-radius:24px;max-width:420px;width:100%;max-height:85vh;overflow-y:auto;animation:slideUp 0.3s ease}
        @keyframes slideUp{from{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}
        .popup-header{background:linear-gradient(135deg,#01BC66,#00A659);color:#fff;padding:26px 22px;text-align:center;position:sticky;top:0;z-index:10}
        .popup-header h3{font-size:1.35em;margin-bottom:4px}
        .popup-header p{opacity:0.9;font-size:0.9em}
        .close-btn{position:absolute;top:14px;right:14px;width:34px;height:34px;background:rgba(255,255,255,0.2);border:none;border-radius:50%;color:#fff;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .popup-body{padding:24px}
        .hook-box{background:linear-gradient(135deg,#E6FBF0,#f0fff6);border-left:4px solid #01BC66;padding:18px 20px;margin-bottom:24px;border-radius:0 14px 14px 0}
        .hook-text{font-size:1.15em;font-weight:600;color:#1a1a1a;line-height:1.5}
        .section{margin-bottom:22px}
        .section h4{color:#01BC66;font-size:1.05em;font-weight:600;margin-bottom:8px}
        .section p{color:#4a5568;line-height:1.7;font-size:0.95em}
        .popup-btn{display:block;width:100%;padding:16px;background:linear-gradient(135deg,#01BC66,#00A659);color:#fff;text-align:center;text-decoration:none;border-radius:14px;font-weight:600;font-size:1.05em;margin-top:24px;box-shadow:0 4px 15px rgba(2,169,92,0.3)}
        .footer{text-align:center;padding:15px;font-size:0.8em;color:#718096}
        .footer a{color:#01BC66;text-decoration:none}
    </style>
</head>
<body>
    <div class="card">
        <div class="slideshow" id="slideshow">
            <div class="auto-ind" id="autoInd"><div class="pulse"></div><span>Auto</span></div>
            <div class="slides-track" id="track">
                ${images.map((url, i) => `<div class="slide"><img src="${url}" alt="Photo ${i+1}"></div>`).join('')}
            </div>
            <div class="dots" id="dots">
                ${images.map((_, i) => `<div class="dot${i===0?' active':''}" onclick="goTo(${i})"></div>`).join('')}
            </div>
            <div class="i-btn" onclick="openPopup()">i</div>
        </div>
        <div class="content">
            <h2>${escapeHtml(campaignName)}</h2>
            <p>Swipe photos ‚Ä¢ Tap i for the full story</p>
        </div>
        <div class="footer">Made with <a href="https://itabs.ai" target="_blank">iTabs</a></div>
    </div>

```
<div class="popup-overlay" id="popup" onclick="closePopup(event)">
    <div class="popup" onclick="event.stopPropagation()">
        <div class="popup-header">
            <button class="close-btn" onclick="closePopup()">&times;</button>
            <h3>${escapeHtml(campaignName)}</h3>
            <p>The full story</p>
        </div>
        <div class="popup-body">
            ${hook ? `<div class="hook-box"><p class="hook-text">${escapeHtml(hook)}</p></div>` : ''}
            ${section1 ? `<div class="section"><h4>üö® The Crisis</h4><p>${escapeHtml(section1)}</p></div>` : ''}
            ${section2 ? `<div class="section"><h4>üíî Why We Need Help</h4><p>${escapeHtml(section2)}</p></div>` : ''}
            ${section3 ? `<div class="section"><h4>üí∞ Where Money Goes</h4><p>${escapeHtml(section3)}</p></div>` : ''}
            ${section4 ? `<div class="section"><h4>‚úÖ Why Trust This</h4><p>${escapeHtml(section4)}</p></div>` : ''}
            <a href="${escapeHtml(buttonLink)}" class="popup-btn" target="_blank">${escapeHtml(buttonText)}</a>
        </div>
    </div>
</div>

<script>
    let cur=0,auto=${autoplay},intv;
    const total=${images.length};
    function goTo(i){cur=i;document.getElementById('track').style.transform='translateX(-'+cur*100+'%)';document.querySelectorAll('.dot').forEach((d,j)=>d.classList.toggle('active',j===cur))}
    function next(){cur=(cur+1)%total;goTo(cur)}
    function startAuto(){if(auto){intv=setInterval(next,3000)}}
    function stopAuto(){clearInterval(intv)}
    function openPopup(){document.getElementById('popup').classList.add('active');document.body.style.overflow='hidden';stopAuto()}
    function closePopup(e){if(!e||e.target.id==='popup'||e.target.classList.contains('close-btn')){document.getElementById('popup').classList.remove('active');document.body.style.overflow='';startAuto()}}
    document.addEventListener('keydown',e=>{if(e.key==='Escape')closePopup()});
    let sx=0;document.getElementById('slideshow').addEventListener('touchstart',e=>sx=e.changedTouches[0].screenX);
    document.getElementById('slideshow').addEventListener('touchend',e=>{const d=sx-e.changedTouches[0].screenX;if(Math.abs(d)>50){d>0?next():goTo((cur-1+total)%total)}});
    startAuto();
<\/script>
```

</body>
</html>`;
        }

```
    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
    
    // ========== UTILITY BUTTONS ==========
    function clearForm() {
        if (!confirm('Clear everything and start fresh?')) return;
        
        // Clear all text fields
        document.getElementById('storyText').value = '';
        document.getElementById('contextWho').value = '';
        document.getElementById('contextUrgency').value = '';
        document.getElementById('contextLocation').value = '';
        document.getElementById('contextTried').value = '';
        document.getElementById('contextExtra').value = '';
        document.getElementById('campaignName').value = '';
        document.getElementById('hookLine').value = '';
        document.getElementById('section1').value = '';
        document.getElementById('section2').value = '';
        document.getElementById('section3').value = '';
        document.getElementById('section4').value = '';
        document.getElementById('buttonText').value = 'Donate Now';
        document.getElementById('buttonLink').value = '';
        
        // Clear URL inputs
        for (let i = 1; i <= 5; i++) {
            const urlInput = document.getElementById('imageUrl' + i);
            if (urlInput) urlInput.value = '';
        }
        
        // Clear photos
        resetPhotos();
        
        // Hide any status messages
        hideStatus('statusMessage');
        hideStatus('saveStatus');
        
        updatePreview();
    }
    
    function resetPhotos() {
        selectedPhotos = [];
        photoDataUrls = [];
        uploadedImageUrls = [];
        
        // Reset all thumbnails
        for (let i = 1; i <= 5; i++) {
            clearThumbnail(i);
        }
        
        // Clear file input
        document.getElementById('photosPicker').value = '';
        
        // Clear URL inputs
        for (let i = 1; i <= 5; i++) {
            const urlInput = document.getElementById('imageUrl' + i);
            if (urlInput) urlInput.value = '';
        }
        
        updatePreview();
    }
    
    function loadExample() {
        // Medical campaign example
        document.getElementById('campaignName').value = "Help Sarah Fight Cancer";
        document.getElementById('hookLine').value = "Sarah is a single mum of two, fighting Stage 3 breast cancer. She needs $35,000 to survive.";
        document.getElementById('section1').value = "Sarah, 34, was diagnosed with Stage 3 breast cancer two months ago. She's a single mum with two kids under 10. The cancer has spread to her lymph nodes and she needs aggressive chemotherapy starting immediately.";
        document.getElementById('section2').value = "Without treatment, Sarah has less than 18 months. Her kids would grow up without their mum. The treatment gives her an 80% survival rate, but she can't work during chemo and her savings are already gone from initial tests.";
        document.getElementById('section3').value = "$15,000 for 6 months of chemotherapy co-pays. $8,000 for medication not covered by insurance. $7,000 for living expenses while Sarah can't work. $5,000 emergency fund for complications.";
        document.getElementById('section4').value = "I'm Sarah's sister, Emma. Hospital records confirm her diagnosis (privacy-protected copies available). I'll post weekly updates with receipts. Sarah's oncologist, Dr. Chen at Perth General, can verify her treatment plan.";
        document.getElementById('buttonText').value = "Donate to Sarah's Fight";
        document.getElementById('buttonLink').value = "https://gofundme.com";
        
        // Load example images from Unsplash
        const exampleImages = [
            "https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=600",
            "https://images.unsplash.com/photo-1576091160550-2173dba999ef?w=600",
            "https://images.unsplash.com/photo-1631815588090-d4bfec5b1ccb?w=600",
            "https://images.unsplash.com/photo-1516549655169-df83a0774514?w=600",
            "https://images.unsplash.com/photo-1559839914-17aae19cec71?w=600"
        ];
        
        photoDataUrls = exampleImages;
        uploadedImageUrls = exampleImages; // These are already URLs
        
        // Update thumbnails
        exampleImages.forEach((url, index) => {
            const thumb = document.getElementById('thumb' + (index + 1));
            thumb.innerHTML = `<img src="${url}" alt="Photo ${index + 1}">`;
            thumb.classList.add('filled');
        });
        
        updatePreview();
    }
</script>
```

</body>
</html>
